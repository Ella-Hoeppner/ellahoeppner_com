shadow$provide.module$node_modules$resource_loader$dist$resource_loader_cjs=function(global,require,module,exports){function _interopDefault(ex){return ex&&"object"===typeof ex&&"default"in ex?ex["default"]:ex}function _noop(){}function eachSeries(array,iterator,callback,deferNext){var i=0,len=array.length;(function next(err){err||i===len?callback&&callback(err):deferNext?setTimeout(function(){iterator(array[i++],next)},1):iterator(array[i++],next)})()}function onlyOnce(fn){return function(){if(null===
fn)throw Error("Callback was already called.");var callFn=fn;fn=null;callFn.apply(this,arguments)}}function queue(worker,concurrency){function _insert(data,insertAtFront,callback){if(null!=callback&&"function"!==typeof callback)throw Error("task callback must be a function");q.started=!0;null==data&&q.idle()?setTimeout(function(){return q.drain()},1):(data={data:data,callback:"function"===typeof callback?callback:_noop},insertAtFront?q._tasks.unshift(data):q._tasks.push(data),setTimeout(function(){return q.process()},
1))}function _next(task){return function(){--workers;task.callback.apply(task,arguments);null!=arguments[0]&&q.error(arguments[0],task.data);workers<=q.concurrency-q.buffer&&q.unsaturated();q.idle()&&q.drain();q.process()}}if(null==concurrency)concurrency=1;else if(0===concurrency)throw Error("Concurrency must not be zero");var workers=0,q={_tasks:[],concurrency:concurrency,saturated:_noop,unsaturated:_noop,buffer:concurrency/4,empty:_noop,drain:_noop,error:_noop,started:!1,paused:!1,push:function(data,
callback){_insert(data,!1,callback)},kill:function(){workers=0;q.drain=_noop;q.started=!1;q._tasks=[]},unshift:function(data,callback){_insert(data,!0,callback)},process:function(){for(;!q.paused&&workers<q.concurrency&&q._tasks.length;){var task=q._tasks.shift();0===q._tasks.length&&q.empty();workers+=1;workers===q.concurrency&&q.saturated();worker(task.data,onlyOnce(_next(task)))}},length:function(){return q._tasks.length},running:function(){return workers},idle:function(){return 0===q._tasks.length+
workers},pause:function(){!0!==q.paused&&(q.paused=!0)},resume:function(){if(!1!==q.paused){q.paused=!1;for(var w=1;w<=q.concurrency;w++)q.process()}}};return q}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;"value"in descriptor&&(descriptor.writable=!0);Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&
_defineProperties(Constructor.prototype,protoProps);staticProps&&_defineProperties(Constructor,staticProps);return Constructor}function _noop$1(){}function setExtMap(map,extname,val){extname&&0===extname.indexOf(".")&&(extname=extname.substring(1));extname&&(map[extname]=val)}function reqType(xhr){return xhr.toString().replace("object ","")}function encodeBinary(input){for(var output="",inx=0;inx<input.length;){for(var bytebuffer=[0,0,0],encodedCharIndexes=[0,0,0,0],jnx=0;jnx<bytebuffer.length;++jnx)bytebuffer[jnx]=
inx<input.length?input.charCodeAt(inx++)&255:0;encodedCharIndexes[0]=bytebuffer[0]>>2;encodedCharIndexes[1]=(bytebuffer[0]&3)<<4|bytebuffer[1]>>4;encodedCharIndexes[2]=(bytebuffer[1]&15)<<2|bytebuffer[2]>>6;encodedCharIndexes[3]=bytebuffer[2]&63;switch(inx-(input.length-1)){case 2:encodedCharIndexes[3]=64;encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64}for(bytebuffer=0;bytebuffer<encodedCharIndexes.length;++bytebuffer)output+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(encodedCharIndexes[bytebuffer])}return output}
Object.defineProperty(exports,"__esModule",{value:!0});var parseUri=_interopDefault(require("module$node_modules$parse_uri$index")),Signal=_interopDefault(require("module$node_modules$mini_signals$lib$mini_signals"));global={eachSeries:eachSeries,queue:queue};var cache={},useXdr=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),tempAnchor=null,Resource$jscomp$0=function(){function Resource(name,url,options){if("string"!==typeof name||"string"!==typeof url)throw Error("Both name and url are required for constructing a resource.");
options=options||{};this._flags=0;this._setFlag(Resource.STATUS_FLAGS.DATA_URL,0===url.indexOf("data:"));this.name=name;this.url=url;this.extension=this._getExtension();this.data=null;this.crossOrigin=!0===options.crossOrigin?"anonymous":options.crossOrigin;this.timeout=options.timeout||0;this.loadType=options.loadType||this._determineLoadType();this.xhrType=options.xhrType;this.metadata=options.metadata||{};this.xhr=this.error=null;this.children=[];this.type=Resource.TYPE.UNKNOWN;this.progressChunk=
0;this._dequeue=_noop$1;this._onLoadBinding=null;this._elementTimer=0;this._boundComplete=this.complete.bind(this);this._boundOnError=this._onError.bind(this);this._boundOnProgress=this._onProgress.bind(this);this._boundOnTimeout=this._onTimeout.bind(this);this._boundXhrOnError=this._xhrOnError.bind(this);this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this);this._boundXhrOnAbort=this._xhrOnAbort.bind(this);this._boundXhrOnLoad=this._xhrOnLoad.bind(this);this.onStart=new Signal;this.onProgress=new Signal;
this.onComplete=new Signal;this.onAfterMiddleware=new Signal}Resource.setExtensionLoadType=function(extname,loadType){setExtMap(Resource._loadTypeMap,extname,loadType)};Resource.setExtensionXhrType=function(extname,xhrType){setExtMap(Resource._xhrTypeMap,extname,xhrType)};var _proto=Resource.prototype;_proto.complete=function(){this._clearEvents();this._finish()};_proto.abort=function(message){if(!this.error){this.error=Error(message);this._clearEvents();if(this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();
else if(this.data)if(this.data.src)this.data.src=Resource.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}};_proto.load=function(cb){var _this=this;if(!this.isLoading)if(this.isComplete)cb&&setTimeout(function(){return cb(_this)},1);else{if(cb)this.onComplete.once(cb);this._setFlag(Resource.STATUS_FLAGS.LOADING,!0);this.onStart.dispatch(this);if(!1===this.crossOrigin||"string"!==typeof this.crossOrigin)this.crossOrigin=this._determineCrossOrigin(this.url);
switch(this.loadType){case Resource.LOAD_TYPE.IMAGE:this.type=Resource.TYPE.IMAGE;this._loadElement("image");break;case Resource.LOAD_TYPE.AUDIO:this.type=Resource.TYPE.AUDIO;this._loadSourceElement("audio");break;case Resource.LOAD_TYPE.VIDEO:this.type=Resource.TYPE.VIDEO;this._loadSourceElement("video");break;default:useXdr&&this.crossOrigin?this._loadXdr():this._loadXhr()}}};_proto._hasFlag=function(flag){return 0!==(this._flags&flag)};_proto._setFlag=function(flag,value){this._flags=value?this._flags|
flag:this._flags&~flag};_proto._clearEvents=function(){clearTimeout(this._elementTimer);this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1));this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",
this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))};_proto._finish=function(){if(this.isComplete)throw Error("Complete called again for an already completed resource.");this._setFlag(Resource.STATUS_FLAGS.COMPLETE,!0);this._setFlag(Resource.STATUS_FLAGS.LOADING,
!1);this.onComplete.dispatch(this)};_proto._loadElement=function(type){this.data=this.metadata.loadElement?this.metadata.loadElement:"image"===type&&"undefined"!==typeof window.Image?new Image:document.createElement(type);this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin);this.metadata.skipSource||(this.data.src=this.url);this.data.addEventListener("error",this._boundOnError,!1);this.data.addEventListener("load",this._boundComplete,!1);this.data.addEventListener("progress",this._boundOnProgress,
!1);this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))};_proto._loadSourceElement=function(type){this.data=this.metadata.loadElement?this.metadata.loadElement:"audio"===type&&"undefined"!==typeof window.Audio?new Audio:document.createElement(type);if(null===this.data)this.abort("Unsupported element: "+type);else{this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin);if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:
this.url;else if(Array.isArray(this.url))for(var mimeTypes=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(type,this.url[i],Array.isArray(mimeTypes)?mimeTypes[i]:mimeTypes));else mimeTypes=this.metadata.mimeType,this.data.appendChild(this._createSource(type,this.url,Array.isArray(mimeTypes)?mimeTypes[0]:mimeTypes));this.data.addEventListener("error",this._boundOnError,!1);this.data.addEventListener("load",this._boundComplete,!1);this.data.addEventListener("progress",
this._boundOnProgress,!1);this.data.addEventListener("canplaythrough",this._boundComplete,!1);this.data.load();this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}};_proto._loadXhr=function(){"string"!==typeof this.xhrType&&(this.xhrType=this._determineXhrType());var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,!0);xhr.timeout=this.timeout;xhr.responseType=this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT?Resource.XHR_RESPONSE_TYPE.TEXT:
this.xhrType;xhr.addEventListener("error",this._boundXhrOnError,!1);xhr.addEventListener("timeout",this._boundXhrOnTimeout,!1);xhr.addEventListener("abort",this._boundXhrOnAbort,!1);xhr.addEventListener("progress",this._boundOnProgress,!1);xhr.addEventListener("load",this._boundXhrOnLoad,!1);xhr.send()};_proto._loadXdr=function(){"string"!==typeof this.xhrType&&(this.xhrType=this._determineXhrType());var xdr=this.xhr=new XDomainRequest;xdr.timeout=this.timeout||5E3;xdr.onerror=this._boundXhrOnError;
xdr.ontimeout=this._boundXhrOnTimeout;xdr.onprogress=this._boundOnProgress;xdr.onload=this._boundXhrOnLoad;xdr.open("GET",this.url,!0);setTimeout(function(){return xdr.send()},1)};_proto._createSource=function(type,url,mime){mime||(mime=type+"/"+this._getExtension(url));type=document.createElement("source");type.src=url;type.type=mime;return type};_proto._onError=function(event){this.abort("Failed to load element using: "+event.target.nodeName)};_proto._onProgress=function(event){event&&event.lengthComputable&&
this.onProgress.dispatch(this,event.loaded/event.total)};_proto._onTimeout=function(){this.abort("Load timed out.")};_proto._xhrOnError=function(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request failed. Status: "+xhr.status+', text: "'+xhr.statusText+'"')};_proto._xhrOnTimeout=function(){this.abort(reqType(this.xhr)+" Request timed out.")};_proto._xhrOnAbort=function(){this.abort(reqType(this.xhr)+" Request was aborted by the user.")};_proto._xhrOnLoad=function(){var xhr=this.xhr,text="",status=
"undefined"===typeof xhr.status?200:xhr.status;if(""===xhr.responseType||"text"===xhr.responseType||"undefined"===typeof xhr.responseType)text=xhr.responseText;0===status&&(0<text.length||xhr.responseType===Resource.XHR_RESPONSE_TYPE.BUFFER)?status=200:1223===status&&(status=204);if(2===(status/100|0)){if(this.xhrType===Resource.XHR_RESPONSE_TYPE.TEXT)this.data=text,this.type=Resource.TYPE.TEXT;else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(text),this.type=Resource.TYPE.JSON}catch(e){this.abort("Error trying to parse loaded json: "+
e);return}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser)this.data=(new DOMParser).parseFromString(text,"text/xml");else{var div=document.createElement("div");div.innerHTML=text;this.data=div}this.type=Resource.TYPE.XML}catch(e$0){this.abort("Error trying to parse loaded xml: "+e$0);return}else this.data=xhr.response||text;this.complete()}else this.abort("["+xhr.status+"] "+xhr.statusText+": "+xhr.responseURL)};_proto._determineCrossOrigin=function(url,loc){if(0===
url.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";loc=loc||window.location;tempAnchor||(tempAnchor=document.createElement("a"));tempAnchor.href=url;url=parseUri(tempAnchor.href,{strictMode:!0});var samePort=!url.port&&""===loc.port||url.port===loc.port,protocol=url.protocol?url.protocol+":":"";return url.host===loc.hostname&&samePort&&protocol===loc.protocol?"":"anonymous"};_proto._determineXhrType=function(){return Resource._xhrTypeMap[this.extension]||Resource.XHR_RESPONSE_TYPE.TEXT};
_proto._determineLoadType=function(){return Resource._loadTypeMap[this.extension]||Resource.LOAD_TYPE.XHR};_proto._getExtension=function(){var url=this.url;if(this.isDataUrl){var slashIndex=url.indexOf("/");url=url.substring(slashIndex+1,url.indexOf(";",slashIndex))}else{slashIndex=url.indexOf("?");var hashStart=url.indexOf("#");url=url.substring(0,Math.min(-1<slashIndex?slashIndex:url.length,-1<hashStart?hashStart:url.length));url=url.substring(url.lastIndexOf(".")+1)}return url.toLowerCase()};_proto._getMimeFromXhrType=
function(type){switch(type){case Resource.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource.XHR_RESPONSE_TYPE.JSON:return"application/json";default:return"text/plain"}};_createClass(Resource,[{key:"isDataUrl",get:function(){return this._hasFlag(Resource.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(Resource.STATUS_FLAGS.COMPLETE)}},
{key:"isLoading",get:function(){return this._hasFlag(Resource.STATUS_FLAGS.LOADING)}}]);return Resource}();Resource$jscomp$0.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4};Resource$jscomp$0.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6};Resource$jscomp$0.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};Resource$jscomp$0.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};Resource$jscomp$0._loadTypeMap={gif:Resource$jscomp$0.LOAD_TYPE.IMAGE,
png:Resource$jscomp$0.LOAD_TYPE.IMAGE,bmp:Resource$jscomp$0.LOAD_TYPE.IMAGE,jpg:Resource$jscomp$0.LOAD_TYPE.IMAGE,jpeg:Resource$jscomp$0.LOAD_TYPE.IMAGE,tif:Resource$jscomp$0.LOAD_TYPE.IMAGE,tiff:Resource$jscomp$0.LOAD_TYPE.IMAGE,webp:Resource$jscomp$0.LOAD_TYPE.IMAGE,tga:Resource$jscomp$0.LOAD_TYPE.IMAGE,svg:Resource$jscomp$0.LOAD_TYPE.IMAGE,"svg+xml":Resource$jscomp$0.LOAD_TYPE.IMAGE,mp3:Resource$jscomp$0.LOAD_TYPE.AUDIO,ogg:Resource$jscomp$0.LOAD_TYPE.AUDIO,wav:Resource$jscomp$0.LOAD_TYPE.AUDIO,
mp4:Resource$jscomp$0.LOAD_TYPE.VIDEO,webm:Resource$jscomp$0.LOAD_TYPE.VIDEO};Resource$jscomp$0._xhrTypeMap={xhtml:Resource$jscomp$0.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource$jscomp$0.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource$jscomp$0.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource$jscomp$0.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource$jscomp$0.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource$jscomp$0.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource$jscomp$0.XHR_RESPONSE_TYPE.DOCUMENT,gif:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,png:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,
bmp:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,jpg:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,tif:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,tiff:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,webp:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,tga:Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB,json:Resource$jscomp$0.XHR_RESPONSE_TYPE.JSON,text:Resource$jscomp$0.XHR_RESPONSE_TYPE.TEXT,txt:Resource$jscomp$0.XHR_RESPONSE_TYPE.TEXT,ttf:Resource$jscomp$0.XHR_RESPONSE_TYPE.BUFFER,
otf:Resource$jscomp$0.XHR_RESPONSE_TYPE.BUFFER};Resource$jscomp$0.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw\x3d\x3d";var Url=window.URL||window.webkitURL,rgxExtractUrlHash=/(#[\w-]+)?$/,Loader=function(){function Loader(baseUrl,concurrency){var _this=this;void 0===baseUrl&&(baseUrl="");void 0===concurrency&&(concurrency=10);this.baseUrl=baseUrl;this.progress=0;this.loading=!1;this.defaultQueryString="";this._beforeMiddleware=[];this._afterMiddleware=
[];this._resourcesParsing=[];this._boundLoadResource=function(r,d){return _this._loadResource(r,d)};this._queue=queue(this._boundLoadResource,concurrency);this._queue.pause();this.resources={};this.onProgress=new Signal;this.onError=new Signal;this.onLoad=new Signal;this.onStart=new Signal;this.onComplete=new Signal;for(baseUrl=0;baseUrl<Loader._defaultBeforeMiddleware.length;++baseUrl)this.pre(Loader._defaultBeforeMiddleware[baseUrl]);for(baseUrl=0;baseUrl<Loader._defaultAfterMiddleware.length;++baseUrl)this.use(Loader._defaultAfterMiddleware[baseUrl])}
var _proto=Loader.prototype;_proto.add=function(name,url,options,cb){if(Array.isArray(name)){for(url=0;url<name.length;++url)this.add(name[url]);return this}"object"===typeof name&&(cb=url||name.callback||name.onComplete,options=name,url=name.url,name=name.name||name.key||name.url);"string"!==typeof url&&(cb=options,options=url,url=name);if("string"!==typeof url)throw Error("No url passed to add resource to loader.");"function"===typeof options&&(cb=options,options=null);if(this.loading&&(!options||
!options.parentResource))throw Error("Cannot add resources while the loader is running.");if(this.resources[name])throw Error('Resource named "'+name+'" already exists.');url=this._prepareUrl(url);this.resources[name]=new Resource$jscomp$0(name,url,options);if("function"===typeof cb)this.resources[name].onAfterMiddleware.once(cb);if(this.loading){options=options.parentResource;url=[];for(cb=0;cb<options.children.length;++cb)options.children[cb].isComplete||url.push(options.children[cb]);cb=options.progressChunk*
(url.length+1)/(url.length+2);options.children.push(this.resources[name]);options.progressChunk=cb;for(options=0;options<url.length;++options)url[options].progressChunk=cb;this.resources[name].progressChunk=cb}this._queue.push(this.resources[name]);return this};_proto.pre=function(fn){this._beforeMiddleware.push(fn);return this};_proto.use=function(fn){this._afterMiddleware.push(fn);return this};_proto.reset=function(){this.progress=0;this.loading=!1;this._queue.kill();this._queue.pause();for(var k in this.resources){var res=
this.resources[k];res._onLoadBinding&&res._onLoadBinding.detach();res.isLoading&&res.abort()}this.resources={};return this};_proto.load=function(cb){if("function"===typeof cb)this.onComplete.once(cb);if(this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{cb=100/this._queue._tasks.length;for(var i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=cb;this._onStart();this._queue.resume()}return this};_proto._prepareUrl=function(url){var parsedUrl=
parseUri(url,{strictMode:!0});url=parsedUrl.protocol||!parsedUrl.path||0===url.indexOf("//")?url:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==url.charAt(0)?this.baseUrl+"/"+url:this.baseUrl+url;this.defaultQueryString&&(parsedUrl=rgxExtractUrlHash.exec(url)[0],url=url.substr(0,url.length-parsedUrl.length),url=-1!==url.indexOf("?")?url+("\x26"+this.defaultQueryString):url+("?"+this.defaultQueryString),url+=parsedUrl);return url};_proto._loadResource=function(resource,
dequeue){var _this2=this;resource._dequeue=dequeue;eachSeries(this._beforeMiddleware,function(fn,next){fn.call(_this2,resource,function(){next(resource.isComplete?{}:null)})},function(){resource.isComplete?_this2._onLoad(resource):(resource._onLoadBinding=resource.onComplete.once(_this2._onLoad,_this2),resource.load())},!0)};_proto._onStart=function(){this.progress=0;this.loading=!0;this.onStart.dispatch(this)};_proto._onComplete=function(){this.progress=100;this.loading=!1;this.onComplete.dispatch(this,
this.resources)};_proto._onLoad=function(resource){var _this3=this;resource._onLoadBinding=null;this._resourcesParsing.push(resource);resource._dequeue();eachSeries(this._afterMiddleware,function(fn,next){fn.call(_this3,resource,next)},function(){resource.onAfterMiddleware.dispatch(resource);_this3.progress=Math.min(100,_this3.progress+resource.progressChunk);_this3.onProgress.dispatch(_this3,resource);resource.error?_this3.onError.dispatch(resource.error,_this3,resource):_this3.onLoad.dispatch(_this3,
resource);_this3._resourcesParsing.splice(_this3._resourcesParsing.indexOf(resource),1);_this3._queue.idle()&&0===_this3._resourcesParsing.length&&_this3._onComplete()},!0)};_createClass(Loader,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(concurrency){this._queue.concurrency=concurrency}}]);return Loader}();Loader._defaultBeforeMiddleware=[];Loader._defaultAfterMiddleware=[];Loader.pre=function(fn){Loader._defaultBeforeMiddleware.push(fn);return Loader};Loader.use=
function(fn){Loader._defaultAfterMiddleware.push(fn);return Loader};exports.Loader=Loader;exports.Resource=Resource$jscomp$0;exports.async=global;exports.encodeBinary=encodeBinary;exports.middleware={caching:function(resource,next){var _this=this;if(cache[resource.url])resource.data=cache[resource.url],resource.complete();else resource.onComplete.once(function(){return cache[_this.url]=_this.data});next()},parsing:function(resource,next){if(resource.data&&resource.xhr&&resource.xhrType===Resource$jscomp$0.XHR_RESPONSE_TYPE.BLOB)if(!window.Blob||
"string"===typeof resource.data){var type=resource.xhr.getResponseHeader("content-type");if(type&&0===type.indexOf("image")){resource.data=new Image;resource.data.src="data:"+type+";base64,"+encodeBinary(resource.xhr.responseText);resource.type=Resource$jscomp$0.TYPE.IMAGE;resource.data.onload=function(){resource.data.onload=null;next()};return}}else if(0===resource.data.type.indexOf("image")){var src=Url.createObjectURL(resource.data);resource.blob=resource.data;resource.data=new Image;resource.data.src=
src;resource.type=Resource$jscomp$0.TYPE.IMAGE;resource.data.onload=function(){Url.revokeObjectURL(src);resource.data.onload=null;next()};return}next()}}}
//# sourceMappingURL=module$node_modules$resource_loader$dist$resource_loader_cjs.js.map
