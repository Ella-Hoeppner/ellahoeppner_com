shadow$provide.module$node_modules$$pixi$spritesheet$dist$cjs$spritesheet=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var math=require("module$node_modules$$pixi$math$dist$cjs$math"),core=require("module$node_modules$$pixi$core$dist$cjs$core"),utils=require("module$node_modules$$pixi$utils$dist$cjs$utils"),loaders=require("module$node_modules$$pixi$loaders$dist$cjs$loaders"),Spritesheet=function(){function Spritesheet(texture,data,resolutionFilename){void 0===
resolutionFilename&&(resolutionFilename=null);this._texture=texture instanceof core.Texture?texture:null;this.baseTexture=texture instanceof core.BaseTexture?texture:this._texture.baseTexture;this.textures={};this.animations={};this.data=data;texture=this.baseTexture.resource;this.resolution=this._updateResolution(resolutionFilename||(texture?texture.url:null));this._frames=this.data.frames;this._frameKeys=Object.keys(this._frames);this._batchIndex=0;this._callback=null}Spritesheet.prototype._updateResolution=
function(resolutionFilename){void 0===resolutionFilename&&(resolutionFilename=null);var scale=this.data.meta.scale;resolutionFilename=utils.getResolutionOfUrl(resolutionFilename,null);null===resolutionFilename&&(resolutionFilename=void 0!==scale?parseFloat(scale):1);1!==resolutionFilename&&this.baseTexture.setResolution(resolutionFilename);return resolutionFilename};Spritesheet.prototype.parse=function(callback){this._batchIndex=0;this._callback=callback;this._frameKeys.length<=Spritesheet.BATCH_SIZE?
(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()};Spritesheet.prototype._processFrames=function(initialFrameIndex){for(var frameIndex=initialFrameIndex,maxFrames=Spritesheet.BATCH_SIZE;frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length;){var i=this._frameKeys[frameIndex],data=this._frames[i],rect=data.frame;if(rect){var trim=null;var frame=!1!==data.trimmed&&data.sourceSize?data.sourceSize:data.frame;var orig=new math.Rectangle(0,0,
Math.floor(frame.w)/this.resolution,Math.floor(frame.h)/this.resolution);frame=data.rotated?new math.Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.h)/this.resolution,Math.floor(rect.w)/this.resolution):new math.Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution);!1!==data.trimmed&&data.spriteSourceSize&&(trim=new math.Rectangle(Math.floor(data.spriteSourceSize.x)/
this.resolution,Math.floor(data.spriteSourceSize.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution));this.textures[i]=new core.Texture(this.baseTexture,frame,orig,trim,data.rotated?2:0,data.anchor);core.Texture.addToCache(this.textures[i],i)}frameIndex++}};Spritesheet.prototype._processAnimations=function(){var animations=this.data.animations||{},animName;for(animName in animations){this.animations[animName]=[];for(var i=0;i<animations[animName].length;i++)this.animations[animName].push(this.textures[animations[animName][i]])}};
Spritesheet.prototype._parseComplete=function(){var callback=this._callback;this._callback=null;this._batchIndex=0;callback.call(this,this.textures)};Spritesheet.prototype._nextBatch=function(){var _this=this;this._processFrames(this._batchIndex*Spritesheet.BATCH_SIZE);this._batchIndex++;setTimeout(function(){_this._batchIndex*Spritesheet.BATCH_SIZE<_this._frameKeys.length?_this._nextBatch():(_this._processAnimations(),_this._parseComplete())},0)};Spritesheet.prototype.destroy=function(destroyBase){var _a;
void 0===destroyBase&&(destroyBase=!1);for(var i in this.textures)this.textures[i].destroy();this.textures=this.data=this._frameKeys=this._frames=null;destroyBase&&(null===(_a=this._texture)||void 0===_a?void 0:_a.destroy(),this.baseTexture.destroy());this.baseTexture=this._texture=null};Spritesheet.BATCH_SIZE=1E3;return Spritesheet}();global=function(){function SpritesheetLoader(){}SpritesheetLoader.use=function(resource,next){var _a,_b,loader=this,imageResourceName=resource.name+"_image";if(resource.data&&
resource.type===loaders.LoaderResource.TYPE.JSON&&resource.data.frames&&!loader.resources[imageResourceName]){var multiPacks=null===(_b=null===(_a=resource.data)||void 0===_a?void 0:_a.meta)||void 0===_b?void 0:_b.related_multi_packs;if(Array.isArray(multiPacks))for(_a=function(item){if("string"!==typeof item)return"continue";var itemName=item.replace(".json",""),itemUrl=utils.url.resolve(resource.url.replace(loader.baseUrl,""),item);if(loader.resources[itemName]||Object.values(loader.resources).some(function(r){return utils.url.format(utils.url.parse(r.url))===
itemUrl}))return"continue";loader.add(itemName,itemUrl,{crossOrigin:resource.crossOrigin,loadType:loaders.LoaderResource.LOAD_TYPE.XHR,xhrType:loaders.LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:resource})},_b=0;_b<multiPacks.length;_b++)_a(multiPacks[_b]);multiPacks={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata,parentResource:resource};_a=SpritesheetLoader.getResourcePath(resource,loader.baseUrl);loader.add(imageResourceName,_a,multiPacks,function(res){if(res.error)next(res.error);
else{var spritesheet=new Spritesheet(res.texture,resource.data,resource.url);spritesheet.parse(function(){resource.spritesheet=spritesheet;resource.textures=spritesheet.textures;next()})}})}else next()};SpritesheetLoader.getResourcePath=function(resource,baseUrl){return resource.isDataUrl?resource.data.meta.image:utils.url.resolve(resource.url.replace(baseUrl,""),resource.data.meta.image)};return SpritesheetLoader}();exports.Spritesheet=Spritesheet;exports.SpritesheetLoader=global}
//# sourceMappingURL=module$node_modules$$pixi$spritesheet$dist$cjs$spritesheet.js.map
